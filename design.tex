\section{Sensibility Testbed Architecture}\label{sec-design}

%\cappos{moved here for now.  This may need to be removed altogether.}
The basic operation of \sysname involves three separate 
parties: a \textit{device owner} interested in participating in 
experiments, a \textit{clearinghouse} that discovers the
participating devices, and configures privacy policies on the 
devices,  a \textit{researcher} seeking to run experiments on 
remote devices. 
%As stated in Section~\ref{sec-overview}, the architecture of Sensibility 
%Testbed involves three interacting parties:  
%as shown in Figure~\ref{fig-arch}: 
%researchers, a clearinghouse server, and mobile device owners. 
%discuss the role and functions of each party, and introduce their key 
%techniques. We 
In this section, we use the same example as in 
Section~\ref{sec-overview} to explain the interaction between these 
parties, where researcher Rhonda wants to know the cellular service quality 
using Alice's device.

%\begin{figure}
%\center{\includegraphics[width=\columnwidth]{figs/arch.pdf}}
%%\vspace*{-20pt}
%\caption{\small Sensibility Testbed architecture. \label{fig-arch}}
%\end{figure}

\subsection{Informed Consent}\label{subsec:informed-consent}

After downloading the app, it informs Alice about the testbed's usage and 
privacy policy in a consent form and must give consent before participating.
The consent form \cappos{figure? cite?} explicitly notifies the user about the 
types of data that may be collected from their device and how this will
be used for non-advertising research by participating researchers.

\cappos{Possibly omit, possibly figure...

Sensors that are accessible to experimenters using the Sensibility Testbed 
report on environmental data around the device, such as temperature, motion, 
geographic location, etc, but do not snoop on smartphone or network data. For 
example, no network packet payloads (e.g., your communications with Facebook) 
or smartphone MAC addresses (e.g., a unique identifier for your phone) will be 
collected through a WiFi interface. Sensors and types of data collected by a 
researcher may include: 

\begin{itemize}
\item Accelerometer, magnetometer, gyroscope, orientation sensors; microphones; etc.
\item Information about batteries, such as battery technology and level,
\item Device location using GPS, network, or passive location provider (cached 
location data on the device);
\item Network information about Bluetooth, cellular and WiFi connections and 
the connection quality (data rate, signal strength, etc).   
\end{itemize}

Researchers use data they collect to examine problems that impact society 
and perform research experiments. For example, transportation agencies can 
use sensor data to monitor traffic in an area. Application developers can 
monitor how programs perform in the field. Wireless network researchers can 
observe public WiFi and cellular network coverage, and use this information 
to improve public networks. Environmental scientists might use sensor data 
to report on the noise level in different areas of a city. 
}

The policy that a device owner agrees to enables the Sensibility Testbed to
provide access to a researcher to run IRB approved experiments on the device
owner's smartphone.  Each researcher is bound to the IRB agreement of their
experiment and is also bound by the policy of the Sensibility Testbed.  This
means that every researcher does not need to obtain a separate policy with
every experimenter whose device an experiment they will run on.  Instead
each participant only agrees to the policies of the Sensibility Testbed, whose
policies bind the participants together.

Note that this concept has occurred before both in the networking context.  
Perhaps the key innovation behind the success
of PlanetLab was its clever use of policies.  From a technical standpoint,
PlanetLab is effectively just a set of Linux boxes where researchers
at almost any university may obtain a VM.  However, if every researcher needed
to contact colleagues at each other school to manage access, this would be
a logistical nightmare because it would require pairwise agreements between
each institution.  Instead PlanetLab wisely formed the PlanetLab Consortium 
which provided identity and account management once each institution formed
an agreement with it.  This meant that the PlanetLab Consortium serves as
a middle man for policy agreements and that other organizations needed no
direct agreements to cooperate.

This type of agreement is also common in IRB studies, especially involving
medical data.  A patient may agree to have their medical records made 
available for future medical research by outside groups.  Despite the lack
of a direct, study-specific consent form with the end patient, there is
informed consent.  The patient consented to share data with researchers
performing future medical studies given ethical guidelines are followed 
and later medical studies consented to follow those ethical guidelines.

The Sensibility Testbed's use policy provides participants the ability
to control how information is gathered from their device. Participants
have the option to opt out of individual experiments, temporary
disable or stop all experiments at any time, and uninstall the 
application at any time.  As we will discuss in the next subsection,
participants also have the ability to control in a more precise manner
how sensors are accessed on the participant's device.

%usage policy requires that the participants in 
%\sysname must be at least 
%18 years old, and do not belong to protected group such as pregnant women.
%Any other device owner, regardless of country or background, can 
%opt into our testbed in this manner, and can opt out just by uninstalling the app. 
%If Alice agrees, the app will be installed on her device, which includes other
%device software that enforces Rhonda's IRB policies specified at the 
%clearinghouse (Section~\ref{sec-bob-policy}), and allows Alice to set her 
%own policies (Section~\ref{sec-alice-policy}).


\subsection{Device Owner's Policies}\label{sec-alice-policy}
A device manager is a part of the device software that 
allows device owners to control the software running on their 
devices. With the device manager, Alice thus can install and remove 
all the other device software, opt in and out of any experiment, 
and set permissions to access the sensors on Alice's device. 

When the \sysname app is started on Alice's device, the device 
manager interface displays a list of running experiments and their policies. If 
Alice does not agree with any policy, she can opt out of the particular 
experiment using the device manager interface. 

Alice can also configure the policies through the device manager to allow
sensors on her device to be acessed at a granularity she is comfortable with.
Alice sets these policies via the user interface of the \sysname app. 
The device manager then parses them just as the clearinghouse
parses Rhonda's IRB policies, and then passes the policies on to the sandbox.
The implementation of Alice's policies is the same as Rhonda's, through
the use of blurring layers.
These policies supersede any policies set by researcher's IRB. For 
example, if Alice disallows access to her location information, then 
Rhonda's experiment cannot get any location from Alice's device even
Rhonda's IRB allows this access. 


\begin{table*}
\scriptsize
\centering

\bgroup
\def\arraystretch{1.15}% % for table padding
\begin{tabular}{|p{3cm}|p{8cm}|p{4cm}|}
\hline
{\bf Goals\textsuperscript{*}}  & {\bf Sensor data} & {\bf Default policy\textsuperscript{\dag}}  
\\ \hline \hline

\multirow{8}{3cm}{Support research projects. \yanyan{this is not a prevention goal tho.}} 
& Battery status (charging/discharging), temperature, 
 technology, health (good/overheat), battery level, voltage, plug-in type. & 
 \multirow{8}{4cm}{Full precision, round-up (if numeric), or constant.} \\ \cline{2-2}
 
& Bluetooth scan mode, state (enabled/disabled). &  \\ \cline{2-2}
 
& Cellular network roaming status, SIM card status (ready/absent), 
phone status (idle/busy), signal strength. &   \\ \cline{2-2}

& Location service provider. & \\ \cline{2-2}

& WiFi link speed, association state, nearby routers' frequency, signal strength. & \\ \cline{2-2}
  
& Vibrate mode, screen settings (on/off, brightness, timeout), media/ringer 
volume. &  \\ \hline 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\multirow{2}{*}{Prevent keyloggers.} & Motion sensors: accelerometer, gyroscope, magnetometer, 
orientation, ambient light. & Full precision, round-up, random rotation, constant; restrict 
 access frequency. \\ \hline 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\multirow{12}{*}{Prevent locating a device.} & 
\multirow{3}{*}{Latitude, longitude, altitude.}  & Approximate to the nearest 
zipcode region, or city/state/country center; restrict access frequency.  \\\cline{2-3}
%& & Speed. & Round-up, or constant. & \\\cline{3-4}

& \multirow{2}{*}{Nearby Bluetooth device names.} & Hashed device names; restrict 
 access frequency.  \\ \cline{2-3}

& \multirow{2}{*}{Cellular network cell ID, neighboring cell ID(s).} & Randomized ID; restrict access 
frequency.   \\ \cline{2-3}

& \multirow{2}{*}{Cellular network operator ID and name, country code, area code.} & Hashed ID, names, 
and code; restrict access frequency.  \\ \cline{2-3}

& WiFi connection information (SSID and MAC address of the currently connected router). 
& \multirow{3}{4.1cm}{Hashed SSID, randomized MAC address; restrict 
 access frequency.} \\ \cline{2-2}  
& WiFi scan result (nearby WiFi routers' SSIDs and MAC addresses) & \\ \hline 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\multirow{5}{3cm}{Prevent identifying a device owner.} & \multirow{2}{*}{Bluetooth MAC 
address, local name.}  & Randomized MAC address, hashed device names. \\ \cline{2-3}

& Cellular device ID, incoming number.  & Randomized ID and number. \\ \cline{2-3}

& \multirow{2}{*}{WiFi connection information (device MAC address, IP address).} & 
Randomized MAC address, hashed IP address.  \\ \hline 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Start/stop activities & & & \xmark \\ \hline 
%Running applications & & & \xmark \\ \hline 
\multirow{2}{*}{Prevent video/ audio recording.} & 
Take pictures, record videosn using a camera. & \multirow{5}{*}{Disabled} \\ \cline{2-2} 

& Voice record using a microphone. & \\ \cline{1-2} 

\multirow{2}{*}{Prevent actions for owner.}& Scan barcode, search, etc., using an Intent.  &  \\ \cline{2-2} 

& Send/receive messages, delete messages, dial/pick up phone calls. & \\  \cline{1-2} 

Protect owner's contacts. & Contact list of the device owner in an address book. & \\ \hline 

\multicolumn{3}{l}{\textsuperscript{*}\scriptsize These goals are the common goals, though uncommon 
goals exist. For example, motion sensors can be used to fingerprint devices~\cite{bojinov2014mobile}, 
or record conversations~\cite{michalevsky2014gyrophone}.} \\ 

\multicolumn{3}{l}{\textsuperscript{\dag}\scriptsize As new threats emerge, we plan to adjust the default
policies.} \\ 

\end{tabular}
\egroup

\caption{\small Sensibility Testbed's default policies for sensor data.}
\label{tab:default}
%\vspace{-10pt}
\end{table*}


\subsection{Researcher Specifies IRB Policies}\label{sec-ch}
Before conducting any experiments, Rhonda first registers an account 
at the clearinghouse. 
The clearinghouse~\cite{ch} is a testbed server that has two 
responsibilities. First, it keeps track of devices and grants 
researchers access to available devices; and second, it
sets up the relevant IRB policies on behalf of the researcher, that 
must be enforced on remote devices.
%It allows experimenters to register accounts and share 
%access to a common pool of devices.

To register his experiment, Rhonda first fills out a form on the clearinghouse 
web page, which has a list of checkboxes for all available sensors 
and text boxes indicating the precision and frequency at which Rhonda 
desires to access 
each sensor. Rhonda checks off only the sensors necessary for his experiment, 
and sets the policies by filling in the text boxes for each sensor.
In this case, Rhonda specifies that 
his experiment can (1) read location information
from devices at the granularity of a city, (2) read accurate
cellular signal strength and network type, as well as
cell IDs, and (3) get location and
cellular network data updates every 10 minutes. 
%Rhonda then downloads documents to provide to his IRB that 
%explains the details about his experiment, \sysname and the technical 
%restrictions his experiment will have. Rhonda then obtains IRB approval at 
%his institution, provides his institution's IRB policies to the 
%\sysname website, and signs up for his experiment. 
After filling out this form, Rhonda downloads the experiment description 
he provided, the detailed information about \sysname's approved IRB, 
and several relevant forms, such as those addressing consent 
(Section~\ref{sec-repy}), terms of participation (for device owners),  
terms of usage (for the researcher), and so on.  
Rhonda then uses these forms as a template to complete the IRB application 
with his institution. These forms serve as a set of reference documents 
to make it easier for researchers like Rhonda to 
file the necessary IRB paperwork with their institutions.

The form that Rhonda filled out on the clearinghouse website is used to
enforce a set of technical restrictions for his experiment. 
The blurring layers are provided by 
\sysname, and are set up in a non-bypassable fashion -- it is not 
Rhonda's task to implement the approved access policies. This means
that even if Rhonda makes an error in his code or his code is malicious, his 
experiment is still restricted in the data it can acquire. 
Therefore, Rhonda's IRB 
policies which request access to cellular signal strength and network type, would result 
in his experiment being blocked from reading the cellular roaming status and area 
code. Note that the latter information is accessible with the same 
Android permission, but is blocked by \sysname. 
After the application is submitted, Rhonda's IRB may disagree with 
his initial experiment requirements. For example, Rhonda's IRB will not permit
his experiment to access cell IDs in cellular networks, but 
approves the other policies. 
%Rhonda wants to access cell 
%IDs in cellular networks, but his IRB disallows such data access. Rhonda then
In this case, Rhonda will revise the experiment registration form, refile the paperwork, 
and obtain IRB approval. Rhonda then submits the revised  
registration form and his IRB approval to the clearinghouse.

 When an account is approved, Rhonda 
% is assigned a pair of public/private \textit{authentication keys} by the 
%clearinghouse, to authenticate himself with the clearinghouse. This
%researcher 
can sign into the clearinghouse and request a 
number of sandboxes for his experiment. The clearinghouse 
looks up available sandboxes on behalf of Rhonda. If Alice's device is discovered, the 
clearinghouse stores her device's meta information (an anonymized 
key), %\textit{identification key}, 
and assigns her device to Rhonda's experiment account. 

The clearinghouse creates a list of sensor access policies for Rhonda's
experiment, according to Rhonda's specified IRB policies. The 
clearinghouse parses Rhonda's registration form, extracts each sensor name, 
data accuracy and access frequency limits as the 
input parameters to the blurring layer code (to blur an exact location 
to a city center, disallow access to cell IDs, and allow cellular network and 
location query once every 10 minutes). Finally, the clearinghouse 
instructs Alice's device to implement these IRB policies. The involvement 
of the clearinghouse in any given experiment ends at this point.
It does not store any data on the researcher's behalf. 

%Besides assigning devices, the clearinghouse also has the role of 
%instructing the sandboxes assigned to this researcher to add the IRB 
%policies specified during registration. The clearinghouse does so 
%by communicating with the resource managers on those devices, which 
%control the code executed in the sandboxes. 

%However, it can direct the release of data to a server designated by the 
%researcher. To do so, the experimenter must register
%his server by providing its certificate and URL to the
%clearinghouse, which will then instruct the devices
%accessible to the experimenter that all the sensor data collected should be
%sent to this server. The sandboxes on these devices will issue
%\texttt{HTTPS POST} using the server's certificate, and send encrypted
%data to the experimenter's server.

%The key role of this component is to facilitate device sharing, 
%which relieves individual experimenters from repeatedly 
%recruiting devices for each experiment.
%
%Note that in Sensibility Testbed, there are two types of keys. A device
%owner has an \textit{identification key} to identify the app installed on a 
%device. This key is mostly used by a lookup service. 

%This pair of keys are mostly used by the clearinghouse and 
%experiment manager.

%\lois{have you introduced the idea of keys yet? If not, I think this needs to be explained.}

\subsection{Baseline Policies}\label{sec-policy-design}

Policies govern at which accuracy and rate a sandboxed experiment can 
access sensors on a device, if any. 
The goal of \sysname is to protect the device owner's privacy, while making
the data from mobile devices useful for a wide range of research. 
%As mentioned earlier, failure to recognize the vulnerability of
%certain sensors was a key reason for privacy breaches. 
Sensibility Testbed uses \textit{default policies} to specify how 
different types of sensors can be accessed to prevent common privacy and
security attacks, %To privide such protection, \sysname 
%classifies sensors as 
%of low, moderate, or high risk. Sensors of high risk are not accessable to 
%researchers by default, and the sensors of low and moderate risk are further 
%protected by the default policies.
%uses a set of policies to prevent a range of attacks, 
as listed in Table~\ref{tab:default}. 
%These policies roughly fall into three categories.
Researchers can further customize the policies through their IRB
to access sensors at a coarser data granularity. The default and 
customized policies would then be automatically enforced by the \sysname 
infrastructure. 
%\cappos{Shouldn't this detail come earlier?  Why is this here instead?}
Also, the device owner may add their own policies which have ultimate 
control over the maximum sensor access accuracy and rate that an 
experiment can attain.

%\textbf{Category 1.}
The \textit{default policies} disable highly sensitive sensors 
such as cameras and microphones. 
If a microphone is controlled by a malicious party, for example, it can be used to 
intelligently choose data of a higher value to record, such as a credit card 
number or password~\cite{zhang2015leave}. Cameras face similar
risks. Additionally, the default policies disable interrupting actions, such as 
making phone calls, scanning a barcode on behalf of the device owner, 
and accessing an address book. 

%\textbf{Category 2.}
Given our analysis of privacy attacks in the current literature, 
we have identified the three 
most common 
risks for device owners (Section~\ref{sec-our-policies}): (1) identifying a device or its owner, 
(2) locating a device, and (3) inferring keys strokes typed by a device owner. 
As shown in Table~\ref{tab:default}, 
sensor data like MAC address and device ID can be used to identify a device, while latitude, longitude, cell 
IDs, and a WiFi router's SSID can be use to locate a 
device. Motion sensors like accelerometer and gyroscope can also be used
as keyloggers to infer keys typed or icons tapped on a 
smartphone. Compared to cameras and microphones, these 
sensors normally require a background process that continuously 
collects the data, or a sophisticated algorithm that constantly learns 
about the patterns of data generated. 
Therefore, Sensibility Testbed's default policies 
blur data from these sensors, but don't disable them completely. 
For example, the default policies enforce randomized MAC addresses in a 
Bluetooth and WiFi network, approximated location coordinates, and 
control the frequency of access to motion sensor data. Note that keyloggers (risk 3)
are more effective when the access frequency to motion sensors is 
high: Previous work such as ACCessory~\cite{owusu2012accessory}, 
TapPrints~\cite{miluzzo2012tapprints}, TapLogger~\cite{xu2012taplogger}, 
and other projects~\cite{aviv2012practicality} showed that when the 
frequency to get motion sensor data is above a certain threshold, the keyloggers' 
learning algorithms become much more accurate.  
Using \sysname's default policies, we can limit 
motion sensors to be accessed at a rate lower than this threshold. 


%\textbf{Category 3.}
%\sysname's default policies allow research 
%projects to get data at a level that is meaningful. For example, 
%projects that are interested in monitoring human activity, wireless network 
%performance, etc., sensor values are allowed at the granularity that is safe 
%according to the researcher's IRB. 

%The default policies currently allow this data to be 
%accessed with full precision (accuracy can be reduced if the IRB
%does not require full precision), since data such as cellular signal strength and WiFi 
%link speed is typically only meaningful with highest accuracy. While it is true that
%certain data like battery information can be used to infer the location of 
%a device, such techniques only works in conjunction with other data 
%such as cellular data usage~\cite{michalevsky2015powerspy}\footnote{\scriptsize 
%The tracking works by measuring the overall power consumption 
%by the phone's cellular radio. Cellular radio power consumption depends 
%on the distance to the nearest cellular tower and any obstacles between 
%the phone and tower. This combination of factors creates a unique power 
%consumption profile for each geographic location~\cite{battery-use}.}. 
%Since the latter data has been protected by aforementioned policies, such 
%complex privacy attacks become less effective. \jill{not sure if this argument is strong
%because we can't account for every possible combination}

\begin{comment}
\textbf{Risk categorization.}
%Even if an IRB happened 
%to approve such a policy, there are certain sensors that the testbed's
%own IRB designates as off-limits due to the high risk associated with 
%potential breaches. 
%and for which access can be pre-approved with the
%researcher's local IRB. 
%Only those sensors listed on our project 
%wiki page~\cite{sensor-api} are accessible to a researcher. 
A summary of these sensors is listed in Table~\ref{tab:default}.
%with each one categorized as . 
%The list of sensors that Sensibility Testbed provides are all of moderate 
%to low privacy risks (marked by \tickmark), and the testbed further provides policy enforcement
%(Section~\ref{sec-policy}) to protect all the sensor data. Sensors 
%such as cameras and microphones that are deemed sensitive are not 
%exposed to experiment code by default (marked by \xmark). 
The classification into low, moderate or high 
privacy risk is motivated by the Android system, where 
permissions are categorized into different protection levels~\cite{level}:
\textit{normal} permissions are automatically granted to the apps, 
\textit{dangerous} permissions are given based upon the 
user's consent, and so on. In our case, 
%we divide sensors into different risk levels, as shown 
%in Table~\ref{tab:default}. 
%Sensors with low to moderate risk are 
%allowed and protected by IRB policies. Sensors of high risk are 
%disabled by default. 
we divide sensors into different risk levels by the consequences and 
difficulties of a potential attack. If a microphone is controlled by 
a malicious party, it can be used to intelligently choose data of a 
higher value (e.g., credit card number, password) to record~\cite{zhang2015leave}. On the other 
hand, in order to infer a credit card number or password typed on a 
smartphone using motion sensors, the attack requires the installation of 
a sophisticated algorithm on the device that constantly learns about  
the patterns of data generated by accelerometer or gyroscope. In contrast,
using battery information alone is not sufficient to create a fingerprint 
for each device. Different information and mutiple occurrences need to
be pieced together to extract this data~\cite{battery-priv}. Therefore, 
compared to motion sensors, a microphone is considered a higher risk, 
and a battery is a significantly lower risk.

\textbf{Default and customizable policies.}
For sensors of low and moderate risk, the default policies are listed in 
Table~\ref{tab:default}. Our principle to design the the default policies 
is that a device or its owner cannot be identifiable, but research projects
are allowed to get data at a level that is meaningful. For example, Bluetooth
and WiFi network MAC addresses can uniquely identify a device, therefore, 
the default policy for these sensor data is to return randomized MAC 
addresses to an experiment, as in~\cite{aditya2014encore}, and this is 
mandatory (marked by N/A). For research projects that are interested 
in monitoring human activity, wireless network performance, etc., sensor
values are allowed to the granularity that is safe. Some data can be 
accessed at full precision (cellular signal strength, WiFi link speed), 
whereas others have an upper bound on their access frequency. 
\yanyan{how to add frequency to the table?}

\end{comment}


As a consequence of our analysis of previous work, \sysname blurs (or 
even disables access to) sensor data by default.
However, if a finer-grained access is critical to the study, access 
must be requested by going through the \sysname's IRB, in addition to the 
researcher's IRB. Even if both IRBs consent that access at elevated accuracy 
should be granted, the local policies configured by the device owner still 
supersede both \sysname's default policies and the researcher's IRB policies, 
and may still block fine-grained access. We further describe this hierarchy 
of policies in Section~\ref{sec-repy}.

\sysname's default policies are set to appropriate levels to protect against 
known attacks today. %as shown in our analysis in Section~\ref{sec-our-policies}. 
However, these levels will need to change over time as
new attacks emerge and become available. \sysname's IRB allows adjusting 
of sensor access restrictions, therefore making the default policies
stronger over time as they adjust to new attacks. It is also important to note that 
if a researcher's IRB allows access to non-sensitive sensor data, \sysname will 
enable the researcher to obtain that data without control over what the data is used for.
A researcher may succeed in finding a new attack by combining this data with other 
information, for example. However, given the 
knowledge of the new attack, \sysname can update its default policies to prevent against
this type of attack happening with future use. 
%\yanyan{Justin, help!} 
%\cappos{Don't you have some things you would never allow even if the NYU IRB
%approves it?}
%\lois{following up on Yanyan's comment--If the Testbed's IRB says this expanded access is permissable, are the device owner's notified and can they opt out of this study? Otherwise, that would be a direct violation of the privacy protection you claim to give them}
%\lois{I did not touch these last two paragraphs because I still don't know about  the opt-out policy for individuals if this permission is given}
%Depending on the experiment description provided by the 
%researcher, the fields marked with a (*) are the ones that will be blurred.
%
%
%
%As a result, Sensibility Testbed does not
%provide unfettered access to all sensors. 
%Access to sensors of
%higher risk, e.g., the policies that request restricted sensor data, 
%or at higher frequencies than our default policies, 
%needs to go through the Sensibility Testbed's IRB,
%in addition to the researcher's IRB. 
%In most cases, we expect
%that researchers need only go through their local IRB to get
%the sensor access they need for their experiment. 


\subsection{Privacy Policy Enforcement}\label{sec-repy}

In order for Alice to participate in Sensibility Testbed as a device owner,
she starts by installing the Sensibility Testbed app from 
the Android app store~\cite{sensibility-app}. The app includes all the device
software for Alice to give informed consent, configure the permission she
is comfortable with, and for Rhonda's experiment code to conform to the 
IRB policies at the clearinghouse when running on Alice's device.

\subsubsection{Blurring Layers for IRB Policies}\label{sec-bob-policy}

\begin{figure}
\center{\includegraphics[width=0.9\columnwidth]{figs/blur.pdf}}
%\vspace*{-20pt}
\caption{\small Policy stack demonstrating how Sensibility Testbed implements blur policies.
\label{fig-blur}}
\end{figure}

Rhonda's IRB policies are implemented as blurring layers in a secure sandbox, with 
each layer enforcing an access control policy over a sensor on Alice's device. 
The sandbox in \sysname (Section~\ref{sec-sandbox}) provides a list of system 
calls to experiment code, such as \path{get_location()}, \path{get_accelerometer()}. 
Using a system call interposition technique in our prior work~\cite{cappos2010retaining}, 
the sandbox can interject code to control the behavior of these calls. Using this 
technique, a sensor access policy can (1) reduce the precision of the raw sensor data 
returned from a device, such as returning the location of a nearest city rather than the 
device's exact location, and (2) restrict the frequency of access to a sensor, such as the 
access rate of a gyroscope or an accelerometer, to avoid password 
interference~\cite{michalevsky2014gyrophone}.

%and (3) disable  
%access to a certain sensor in sensitive situations, such as 
%turning off a camera when a device is in a residential or work area.
%Implementation of the last policy is still ongoing, so this paper will mainly address
%how blurring layers allow for the execution of the first two types of policies. 

%The sandbox kernel determines how IRB policies are implemented by affecting system calls. It can
%interpose on a call and modify the data returned, or control the frequency with which a call can be made over
%a period of time. 

%Different policies implemented can be stacked in tandem to 
%control different sensor accesses, like in Figure~\ref{fig-blur}.
%As mentioned above, Rhonda provided his IRB policies through our clearinghouse.
%Before Rhonda runs his experiment, the clearinghouse loads the access policies and instructs the sandbox on Alice's device to
%restrict sensor access accordingly. 
%
%Using the \path{get_location()} call as an example, 
%when Rhonda's code requests location data from Alice's device, the Repy sandbox first
%invokes the location-related Android code. 
%%(line 10 in Figure~\ref{fig-getlocation}). 
%When the location data is returned, according to Rhonda's IRB policy
%indicates that the returned location coordinates should be blurred to the nearest city to Alice's
%device, instead of her actual location. As a result, 
%For example, the sandbox returns a perturbed location that is less accurate, 
%%Furthermore, as Rhonda's IRB policy disallows collecting information about cell tower IDs, 
%%blocks any access to cell IDs, 
%%by another policy. Similarly, other information
%blurs a WiFi SSID to a hashed string, and restricts the frequency to access a
%gyroscope to prevent inferring passwords~\cite{michalevsky2014gyrophone}, and so on. 
\textbf{Reducing Data Precision.}
Each blurring layer defines one of the above two categories of policies. 
For example, to blurr Alice's location to a nearest city, the following layer
will be instantiated by the sandbox, as instructed by the clearinghouse:

\begin{Verbatim}
1. \textcolor{Purple}{def} \textbf{\textcolor{NavyBlue}{get_city_location}}():
2.   \textcolor{BrickRed}{"""}
3.   \textcolor{BrickRed}{This function replaces the exact coordinates of} 
4.   \textcolor{BrickRed}{the Android device with the coordinates for the } 
5.   \textcolor{BrickRed}{geographic center of the nearest city.}
6.   \textcolor{BrickRed}{"""}
7.
8.   exact_location = get_location()
9.   city_location = find_closest_city(exact_location)
10.  \textcolor{Purple}{return} city_location
11.
12. \textcolor{BrickRed}{# Substitute get_location with get_city_location.}
13. \textbf{CHILD_CONTEXT_DEF[\textcolor{BrickRed}{"get_location"}] = \{}
14.    \textbf{\textcolor{BrickRed}{"target"}: get_city_location,}
15. \textbf{\}}
\end{Verbatim}

As a result, whenever Rhonda's experiment code calls \path{get_location()}, 
the blurring layer above replaces it with \path{get_city_location()}. Therefore,
this blurring layer guarantees Rhonda's IRB policy.

\textbf{Restricting Data Access Frequency.}
These policies can be implemented in a similar way. When an experiment 
program's use of a sensor is above a given threshold, the blurring layer 
pauses the code for as long as required to bound it, on average, below 
the threshold. Therefore, if an experiment attempts to use a sensor at a 
rate faster than is allowed by a policy, the system call is blocked until 
sufficient time has passed to average out the overall access rate. An example
of this blurring layer that restricts location queries to be once per 10 minutes
is given in our technical report~\cite{zhuangTR15}.

Both the type of blurring layer (blur location to the nearest city) and the 
parameters to each layer (access location once per 10 minutes) are parsed
by the clearinghouse from Rhonda's input, and passed on to the sandbox on 
Alice's device. Each blurring layer is implemented as templated code, 
pre-loaded in each sandbox, and can be instantiated with parameters 
once the clearinghouse instructs it to do so.

\textbf{Policy Stack.}
Different sets of policies can be customized 
according to the regulations set by Rhonda's IRB, through loading 
individual blurring layers in order, as a policy stack. In each stack, 
a lower layer is the ancestor of a higher layer. Every layer inherits 
the policy defined by its ancestor layers, with the exception of the lowest layer. 
%Each blurring layer is untrusted by its ancestor layers, 
%but is trusted by its descendant layers. \yanyan{maybe cut this.}
The lowest blurring layer with no ancestors is the 
Sensibility Testbed's sandbox kernel. The experiment program runs at the top 
of the policy stack, thereby inheriting all the policies defined by the
lower layers, as shown in Figure~\ref{fig-blur}. 
Each policy stack acts as a set of filters for different sensors, through 
which a call must pass before a sandboxed program can
access the sensor data. 
%Different stacks can be customized for different IRB policies.

When Rhonda starts his experiment, the sandbox %uses its blurring layer creation call to 
instantiates the first blurring layer according to its contract, i.e., the function 
mapping that contains the kernel's exported functions.
%the security layer instantiation call, and the remaining
%command-line arguments. 
The newly instantiated blurring layer repeats this process 
%using the 
%encasement library's
%blurring layer creation call 
to instantiate the next security layer with a potentially updated contract and 
function mapping. Eventually, Rhonda's program is instantiated
in a separate layer with the functions provided
through the stack of blurring layers that preceded it.
Rhonda's program will then be subject to all the 
policies defined in the preceding layers, or the policy stack. 
As a result,  the policies are transparently applied to Rhonda's experiment code. 

This mechanism is transparent to the experimenters 
and device owners, as the implementation of policies is controlled by the 
clearinghouse on behalf of the experimenters. An experimenter is aware 
of certain policies in place, but does not need to implement or explicitly
enforce such policies. 
\jill{we should add something in this example about how default policies play a role}
\yanyan{Can we explain how some policies supersede other policies? ie, device
owner's policies > \sysname default policies > researcher's IRB policies.}
%In the following, we describe how to implement each blurring layer, 
%and use them to form a policy stack.


\subsection{Researcher Conducts an Experiment}\label{sec-emt}

%The last component in the testbed is an experiment manager, which 
To run code on Alice's device, Rhonda needs to download an experiment 
manager to his own computer.
Rhonda uses the experiment manager as a light-weight command line 
console~\cite{demo-kit} to directly access Alice's device, upload 
experiment code, and %written in the Repy programming interface, and
communicate with Alice's device to start or stop the execution of the experiment. 
%To authenticate himself with the remote sandbox, the researcher uses 
%his public/private key pairs to establish a secure connection from his
%computer. 
The experiment manager can also be used to download data 
from the remote devices to Rhonda's local computer, or
Rhonda can set up his own server to store the data\footnote{\scriptsize
If a researcher stores data on his own server, he must use protective
measures to ensure that data sent from the mobile devices is
properly encrypted, and the server storage cannot be tampered
with by any other parties. This is enforced by requiring the experimenter to register
his server by providing its certificate and URL to our
clearinghouse. Following receipt of this data, the clearinghouse will instruct the devices
accessible to the experimenter that all the sensor data collected should be
sent to this server. The sandboxes on these devices will issue
\texttt{HTTPS POST} using the server's certificate, and send encrypted
data to the experimenter's server.}. 
If Rhonda stores data on his own server, he must use protective
measures to ensure that data sent from the mobile devices is
properly encrypted, and the server storage cannot be tampered
with by any other parties. Researchers can also opt to use a data 
store service we provide (a service called Sensevis~\cite{sensevis}). 
After the data is collected, the method of 
securely storing the data will be mandated by Rhonda's IRB.

\smallskip
This Sensibility Testbed clearinghouse protocol for research plays a central role in
easing the process of device recruitment and experiment setup for experimenters, 
and ensures the enforcement of privacy policies. 
%Prior to running an experiment on Sensibility Testbed, a
%experimenter first fills out a form in plain text to describe the
%purpose of the research experiment. This experiment description
%is created at the Sensibility Testbed clearinghouse
%where the researcher indicates the type of data to be collected,
%how that data will be used and stored, and so on. 
%
%Once this information is collected from the researcher, the
%clearinghouse automatically generates a set of blurring layers
%that implements the experiment policy (Section~\ref{sec-policy}). In
%Sensibility Testbed, researchers can collect data from the
%sensors on the device, such as GPS, Bluetooth, battery
%information, accelerometer, light, and orientation,
%etc. The blurring layers we provide consist of
%data access restrictions, created in accordance with
%researcher's experiment description, by using the Sensibility
%Testbed's sandboxing technique 
%(Section~\ref{sec-repy})~\cite{cappos2010retaining}. These restrictions ensure that
%the researcher cannot conduct experiments to access data that
%extend beyond the experiment policy. 
%
%This Sensibility Testbed
%clearinghouse protocol for research plays a central role in
%easing the approval process of IRB, and ensures the enforcement
%of privacy policy\footnote{The Sensibility Testbed Clearinghouse
%protocol for research with human subjects has been approved by
%the IRB at New York University. \yanyan{might need a link to
%your approval letter or ref number}}. 
Using Sensibility Testbed, device owners' privacy is protected
from any inadvertent or malicious attempt, and researchers 
are able to go through a streamlined process of device 
recruitment and experiment setup.

